<?xml version="1.0" encoding="utf-8"?><!DOCTYPE nta PUBLIC '-//Uppaal Team//DTD Flat System 1.1//EN' 'http://www.it.uu.se/research/group/darts/uppaal/flat-1_1.dtd'><nta><declaration>// Place global declarations here.

// Default
int [0,2] motorState = 1; // 0 = idle, 1 = assist, 2 = recharge

// My variables
int [0,1] brake;
int [0,1] batteryLevel = 1;

// My clocks
clock schedule_timer;  // Scheduler timer
clock timer1; // Motor timer
clock timer2; // Observer timer

// My channels
chan batteryUpdate; // Scheduler - Battery communication
chan brakeUpdate; // Scheduler - Brake communication
chan motorUpdate; // Scheduler - Motor communication
broadcast chan braking; // Observer - Brake communication (note the broadcast)
</declaration><template><name x="5" y="5">Motor</name><declaration>// Place local declarations here.

</declaration><location id="id0" x="176" y="272"><name x="184" y="288">Idle</name></location><location id="id1" x="-112" y="272"><name x="-160" y="288">Recharge</name></location><location id="id2" x="48" y="-16"><name x="38" y="-46">Assist</name></location><location id="id3" x="48" y="144"><name x="72" y="136">Choose</name><committed/></location><init ref="id2"/><transition><source ref="id0"/><target ref="id3"/><label kind="synchronisation" x="40" y="272">motorUpdate?</label><nail x="128" y="280"/><nail x="48" y="200"/></transition><transition><source ref="id2"/><target ref="id3"/><label kind="synchronisation" x="96" y="32">motorUpdate?</label><label kind="assignment" x="96" y="48">timer1 := 0</label><nail x="88" y="16"/><nail x="88" y="120"/></transition><transition><source ref="id1"/><target ref="id3"/><label kind="synchronisation" x="-72" y="112">motorUpdate?</label><nail x="-112" y="216"/><nail x="-8" y="136"/></transition><transition><source ref="id3"/><target ref="id0"/><label kind="assignment" x="96" y="168">motorState := 0</label></transition><transition><source ref="id3"/><target ref="id1"/><label kind="assignment" x="-56" y="184">motorState := 2</label></transition><transition><source ref="id3"/><target ref="id2"/><label kind="assignment" x="-64" y="40">motorState := 1</label></transition></template><template><name>Brake</name><location id="id4" x="-176" y="-80"><name x="-240" y="-104">Choose</name><committed/></location><location id="id5" x="-176" y="48"><name x="-200" y="56">Pressed</name></location><location id="id6" x="-176" y="-208"><name x="-208" y="-240">Released</name></location><init ref="id6"/><transition controllable="false"><source ref="id6"/><target ref="id4"/><label kind="synchronisation" x="-120" y="-160">brakeUpdate?</label><nail x="-128" y="-192"/><nail x="-128" y="-96"/></transition><transition controllable="false"><source ref="id5"/><target ref="id4"/><label kind="synchronisation" x="-320" y="-16">brakeUpdate?</label><nail x="-224" y="32"/><nail x="-224" y="-64"/></transition><transition controllable="false"><source ref="id4"/><target ref="id5"/><label kind="synchronisation" x="-168" y="-24">braking!</label><label kind="assignment" x="-168" y="-40">brake := 1</label></transition><transition controllable="false"><source ref="id4"/><target ref="id6"/><label kind="assignment" x="-256" y="-176">brake := 0</label></transition></template><template><name>Battery</name><location id="id7" x="208" y="-16"><name x="224" y="-24">Low</name></location><location id="id8" x="-48" y="-16"><name x="-72" y="-72">Choose</name><committed/></location><location id="id9" x="-304" y="-16"><name x="-352" y="-24">High</name></location><init ref="id9"/><transition controllable="false"><source ref="id8"/><target ref="id7"/><label kind="guard" x="48" y="-120">batteryLevel == 0</label><nail x="32" y="-96"/><nail x="160" y="-96"/></transition><transition controllable="false"><source ref="id8"/><target ref="id9"/><label kind="guard" x="-240" y="-120">batteryLevel == 1</label><nail x="-128" y="-96"/><nail x="-256" y="-96"/></transition><transition controllable="false"><source ref="id7"/><target ref="id8"/><label kind="synchronisation" x="-32" y="32">batteryUpdate?</label><nail x="64" y="32"/><nail x="-32" y="32"/></transition><transition controllable="false"><source ref="id9"/><target ref="id8"/><label kind="synchronisation" x="-160" y="32">batteryUpdate?</label><nail x="-160" y="32"/><nail x="-64" y="32"/></transition><transition controllable="false"><source ref="id8"/><target ref="id7"/><label kind="guard" x="-16" y="-16">motorState == 1</label><label kind="assignment" x="72" y="-40">batteryLevel := 0</label></transition><transition controllable="false"><source ref="id8"/><target ref="id9"/><label kind="guard" x="-208" y="-16">motorState == 2</label><label kind="assignment" x="-272" y="-40">batteryLevel := 1</label></transition></template><template><name>Scheduler</name><location id="id10" x="-144" y="80"><name x="-192" y="96">Wait</name><label kind="invariant" x="-288" y="72">schedule_timer &lt;= 1</label></location><location id="id11" x="48" y="80"><name x="64" y="96">MotorUpdate</name><urgent/></location><location id="id12" x="48" y="-112"><name x="64" y="-144">BrakeUpdate</name><urgent/></location><location id="id13" x="-144" y="-112"><name x="-248" y="-144">BatteryUpdate</name><urgent/></location><init ref="id13"/><transition><source ref="id10"/><target ref="id13"/><label kind="guard" x="-288" y="-32">schedule_timer == 1</label><label kind="assignment" x="-288" y="-16">schedule_timer := 0</label><label kind="comments">Sync: the loop? sync was added in order to force the transition from Wait to BatteryUpdate when clock reaches 1.</label></transition><transition><source ref="id11"/><target ref="id10"/><label kind="synchronisation" x="-88" y="80">motorUpdate!</label></transition><transition><source ref="id12"/><target ref="id11"/><label kind="synchronisation" x="64" y="-16">brakeUpdate!</label></transition><transition><source ref="id13"/><target ref="id12"/><label kind="synchronisation" x="-96" y="-112">batteryUpdate!</label></transition></template><template><name>Observer</name><location id="id14" x="112" y="80"><name x="96" y="48">Loop</name></location><init ref="id14"/><transition><source ref="id14"/><target ref="id14"/><label kind="guard" x="72" y="0">brake != 1</label><label kind="synchronisation" x="72" y="-16">braking?</label><label kind="assignment" x="72" y="16">timer2 := 0</label><nail x="64" y="64"/><nail x="64" y="32"/><nail x="160" y="32"/><nail x="160" y="64"/></transition></template><system>system Motor, Brake, Battery, Scheduler, Observer;</system></nta>